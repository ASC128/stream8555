<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stream Player</title>
<meta name="referrer" content="no-referrer">
<script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.17"></script>
<style>
html,body{margin:0;padding:0;background:#000;height:100%;}
.artplayer-app{width:100vw;height:100vh;}
</style>
</head>
<body>

<div class="artplayer-app"></div>

<script>
const WORKER_ORIGIN = "https://stream8555.ascasc128.workers.dev";

function toWorker(url) {
    try { url = decodeURIComponent(url); } catch(e){}
    const u = new URL(url);
    if (u.hostname.includes("hls.zb252")) {
        const path = u.pathname.replace(/^\//,'');
        return `${WORKER_ORIGIN}/hls/${path}${u.search}`;
    }
    return url;
}

function playM3u8(video, url, art) {
    if (Hls.isSupported()) {
        if (art.hls) art.hls.destroy();
        const hls = new Hls({lowLatencyMode:true});
        hls.loadSource(url);
        hls.attachMedia(video);
        art.hls = hls;
        art.on("destroy", () => hls.destroy());
    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = url;
    }
}

const params = new URL(location.href).searchParams;
const raw = params.get("url");
const playUrl = toWorker(raw);

const art = new Artplayer({
    container: '.artplayer-app',
    url: playUrl,
    type: 'm3u8',
    autoplay: true,
    muted: true,
    customType: { m3u8: playM3u8 },
});
</script>

</body>
</html>
