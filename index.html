<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FLV Live Player</title>
  <script src="https://cdn.jsdelivr.net/npm/flv.js@1.6.2/dist/flv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css" />
  <style> body { margin: 0; background: #000; } #dplayer { width: 100%; height: 100vh; } </style>
</head>
<body>

<div id="dplayer"></div>

<script>
  function getRawUrl() {
    const fullQuery = window.location.search;
    const urlMatch = fullQuery.match(/url=(.*)/);
    return urlMatch ? urlMatch[1] : '';
  }

  const flvUrl = getRawUrl();
  const proxyUrl = 'proxy.php?url=' + flvUrl;

  if (!flvUrl) {
    alert('缺少 ?url= 参数');
    throw new Error("No stream URL provided.");
  }

  if (flvjs.isSupported()) {
    const dp = new DPlayer({
      container: document.getElementById('dplayer'),
      live: true,
      autoplay: true,
      video: {
        type: 'customFlv',
        url: proxyUrl,
        customType: {
          customFlv: function (video) {
            const flvPlayer = flvjs.createPlayer({
              type: 'flv',
              url: proxyUrl,
              isLive: true
            });
            flvPlayer.attachMediaElement(video);
            flvPlayer.load();
          }
        }
      }
    });
  } else {
    alert('flv.js is not supported in your browser.');
  }
</script>


</body>
</html>
